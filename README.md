# Техническое задание на разработку программного продукта для планирования встреч
## Команда: teto

## 1. Общие описание
Необходимо разработать программный продукт для планирования встреч сотрудников внутри компании. Система состоит из клиентского мобильного приложения и серверной части.

## 2. Клиентская часть (Android-приложение)
Клиентом является **Android-приложение**, которое должно быть реализовано на **Kotlin** или **Java** с использованием **адаптивной верстки**.

Приложение должно предоставлять интуитивно понятный интерфейс, в котором реализован следующий функционал:

*   **Регистрация и авторизация** сотрудника.
*   **Настройка личного профиля**.
*   **Создание встречи** с возможностью приглашения других сотрудников. Приглашенные сотрудники должны иметь возможность дать бинарный ответ (**принял** / **не принял**).
*   **Просмотр списка активных приглашений** на встречи с возможностью дать ответ о возможности посещения.
*   **Просмотр собственного расписания встреч** в разрезе дня, недели и месяца.

**Важное условие:** временные слоты для встреч разбиты строго по часам. Например, можно создать встречу на 9:00–10:00, но создание встречи на 9:10, 9:05 и т.д. — невозможно.

## 3. Серверная часть
Сервер представляет собой **микросервис на Spring Boot**, работающий с СУБД **PostgreSQL** или **H2**.

Серверное приложение должно:
*   Предоставлять API, необходимый для полноценной работы мобильного приложения.
*   Осуществлять все основные операции с данными в базе через **Spring Data JPA**.
*   Использовать **Liquibase** для создания схемы базы данных и ее предзаполнения.


## User Stories

1.  **Авторизация:** Как сотрудник, я хочу авторизоваться в приложении, чтобы получить доступ к своему личному расписанию и функциям планирования.
2.  **Профиль:** Как пользователь, я хочу редактировать свой профиль (менять аватарку, добавлять контакты), чтобы коллеги могли легко узнать меня и связаться.
3.  **Создание встречи:** Как организатор, я хочу создавать встречи на определенное время (строго по часам) и приглашать коллег, чтобы зарезервировать время для совместного обсуждения рабочих вопросов.
4.  **Управление приглашениями:** Как участник, я хочу видеть входящие приглашения с возможностью принять или отклонить их, чтобы организатор встречи понимал, сможет ли она состояться.
5.  **Расписание:** Как пользователь, я хочу видеть наглядное расписание своих встреч в календаре (на день или месяц), чтобы быстро оценивать свою загруженность и находить свободные окна.

---

## Use Cases

### Авторизация
**Предусловия:** Учетная запись сотрудника предварительно создана администратором.
1.  Пользователь запускает приложение.
2.  Пользователь вводит логин и пароль.
3.  Пользователь нажимает кнопку "Войти".
4.  Приложение отправляет `POST /auth/login` запрос на сервер.
5.  **Альтернативы:**
    * *Успех (200 OK):* Сервер возвращает Access/Refresh токены. Приложение сохраняет их в хранилище и открывает Главный экран.
    * *Ошибка ввода (400/401):* Приложение показывает ошибку валидации поля или неверных кредов.
    * *Ошибка сервера (500/Network):* Приложение показывает Snackbar "Сервис недоступен".

### Редактирование профиля
**Предусловия:** Пользователь авторизован.
1.  Пользователь переходит на экран "Профиль".
2.  Нажимает "Редактировать".
3.  Меняет текстовые поля.
4.  Нажимает "Сохранить".
5.  Приложение отправляет `PATCH /profile`.
6.  **Альтернативы:**
    * *Успех:* Данные обновляются, пользователь видит обновленный профиль.
    * *Ошибка:* Snackbar с описанием ошибки.

Чтобы загрузить фотографию профиля, пользователь использует отдельный эндпоинт `PUT /profile-pic` (без `multipart/form-data`).

**Предусловия:** Пользователь авторизован.
1. Пользователь выбирает фото из галереи.
2. Приложение отправляет `PUT /profile-pic`.
3. Сервер сохраняет изображение и обновляет ссылку на аватар в профиле пользователя.
4. Приложение отображает новую аватарку.

**Альтернативы:**
* *Успех:* Аватарка обновлена, в профиле отображается новое фото.
* *Ошибка:* Snackbar/диалог с описанием ошибки (например, неподдерживаемый формат или слишком большой файл).

### Создание встречи
**Предусловия:** Пользователь авторизован.
1.  Пользователь нажимает FAB "Создать встречу".
2.  Приложение открывает форму создания.
3.  Пользователь выбирает дату в календаре.
4.  **Система загружает занятые слоты** для выбранной даты с сервера.
5.  Приложение отображает доступные часовые интервалы (например, 09:00-10:00) в виде чипсов. Занятые слоты заблокированы.
6.  Пользователь выбирает свободный слот и добавляет участников из списка.
7.  Нажимает "Создать".
8.  Приложение отправляет `POST /meetings`.
9.  **Альтернативы:**
    * *Успех:* Встреча создана, пользователь перенаправляется на главный экран, появляется уведомление.
    * *Слот занят:* Если кто-то успел занять слот раньше, сервер возвращает ошибку. Приложение обновляет список слотов и просит выбрать другое время.

### Просмотр и ответ на приглашение
**Предусловия:** Пользователя пригласили на встречу.
1.  Пользователь открывает вкладку "Приглашения".
2.  Видит список карточек с деталями (Кто, Где, Когда, Тема).
3.  Нажимает "Принять" или "Отклонить".
4.  Приложение отправляет статус на сервер.
5.  Карточка встречи перемещается в общее расписание (если принята) или исчезает (если отклонена).

### Просмотр расписания
**Предусловия:** Пользователь авторизован и имеет запланированные встречи.
1.  Пользователь открывает вкладку "Расписание".
2.  Система отображает календарь на месяц.
    * Дни, в которые есть встречи, отмечены точкой или цветом.
3.  Под календарем отображается список встреч на текущий день.
4.  Пользователь нажимает на другую дату в календаре.
5.  Список под календарем обновляется, показывая встречи для выбранного дня.
6.  **Альтернативы:**
    * *День свободен:* В списке отображается "На этот день встреч нет".
    * *Ошибка загрузки:* Snackbar с кнопкой "Повторить".

---

## ТЗ Для Мобилки

**Настройка и Архитектура**

* [ ] Инициализировать проект, настроить зависимости, базовая навигация, DI модули, базовая Clean
  Architecture.
* [ ] Настроить тему приложения  (цвета, шрифты).

**Авторизация**

* [ ] Сверстать экран авторизации.
* [ ] Data-слой для работы с токенами (сохранение JWT в DataStore).
* [ ] AuthInterceptor для автоматической подстановки токена в запросы.

**Профиль**

* [ ] Сверстать экран просмотра и редактирования профиля.
* [ ] Реализовать логику выбора аватарки из галереи Photo Picker.
    * Загрузка в бэкенд через `PUT /profile-pic`.
    * Ресайз на клиенте до ~512×512, чтобы экономить трафик.

**Встречи и Расписание**

* [ ] Реализовать экран создания встречи.
    * Выбор времени с помощью `FlowRow` и `FilterChip`.
    * Логика генерации чипсов строго по часам: 09:00-10:00...
    * Логика блокировки слотов на основе данных с бэкенда.
* [ ] Реализовать экран "Расписание" с календарем.
    * Использовать компонент `CalendarView` для отображения месяца.
    * Реализовать отображение индикаторов на датах, где есть встречи.
    * Связать клик по дате с обновлением списка снизу (LazyColumn).
* [ ] Реализовать выбор участников встречи (поиск по сотрудникам).

---

### Задачи для backend
**База данных и Конфигурация**
* [ ] Спроектировать ER-диаграмму БД (таблицы `users`, `meetings`, `meeting_participants`).
* [ ] Настроить PostgreSQL и подключить Liquibase.
* [ ] Прописать миграции для создания таблиц.

**Security**
* [ ] Настроить Spring Security.
* [ ] Реализовать генерацию JWT токенов при логине.
* [ ] Настроить фильтры для валидации токенов.

**API Эндпоинты**
* [ ] `POST /auth/login` - Вход и выдача токенов.
* [ ] `GET /users` - Получение списка сотрудников.
* [ ] `PATCH /profile` - Обновление данных профиля текущего пользователя.
* [ ] `PUT /profile-pic` - Загрузка/обновление аватарки (сырое изображение в body, без multipart).
* [ ] `POST /meetings` - Создание встречи (с валидацией времени и пересечений).
* [ ] `GET /meetings/slots` - Получение занятых слотов на дату.
* [ ] `GET /meetings` - Получение всех встреч пользователя за определенный период (startDate, endDate).
    * *Важно:* Нужно для отрисовки точек в календаре на месяц.


## База данных:
Ссылка на схему:
https://dbdiagram.io/d/697a19b0bd82f5fce2e734a6
